
import os

RUNE_MAP = {
    'ᚠ': 0,  'ᚢ': 1,  'ᚦ': 2,  'ᚩ': 3,  'ᚱ': 4,  'ᚳ': 5,  'ᚷ': 6,  'ᚹ': 7,
    'ᚻ': 8,  'ᚾ': 9,  'ᛁ': 10, 'ᛄ': 11, 'ᛇ': 12, 'ᛈ': 13, 'ᛉ': 14, 'ᛋ': 15,
    'ᛏ': 16, 'ᛒ': 17, 'ᛖ': 18, 'ᛗ': 19, 'ᛚ': 20, 'ᛝ': 21, 'ᛟ': 22, 'ᛞ': 23,
    'ᚪ': 24, 'ᚫ': 25, 'ᚣ': 26, 'ᛡ': 27, 'ᛠ': 28,
}

TRANS_MAP = {
    0: 'f', 1: 'u', 2: 'þ', 3: 'o', 4: 'r', 5: 'c', 6: 'g', 7: 'w',
    8: 'h', 9: 'n', 10: 'i', 11: 'j', 12: 'eo', 13: 'p', 14: 'x', 15: 's',
    16: 't', 17: 'b', 18: 'e', 19: 'm', 20: 'l', 21: 'ŋ', 22: 'œ', 23: 'd',
    24: 'a', 25: 'æ', 26: 'y', 27: 'ia', 28: 'ea'
}

KEYS = {
    1: [26, 27, 4, 26, 11, 6, 24, 1, 28, 24, 25, 10, 16, 12, 22, 7, 23, 13, 11, 11, 6, 21, 16, 0, 26, 3, 12, 22, 21, 13, 27, 14, 1, 27, 24, 19, 11, 27, 21, 1, 1, 19, 1, 1, 10, 14, 3, 1, 19, 23, 6, 13, 28, 10, 8, 6, 27, 20, 16, 21, 24, 15, 24, 16, 6, 4, 8, 20, 11, 19, 2],
    2: [6, 24, 28, 9, 0, 9, 0, 27, 21, 25, 4, 6, 22, 2, 18, 9, 6, 18, 12, 14, 12, 27, 9, 24, 27, 16, 11, 14, 13, 16, 16, 11, 3, 2, 11, 6, 18, 12, 6, 14, 18, 12, 18, 4, 22, 5, 0, 21, 18, 21, 13, 8, 6, 24, 5, 19, 5, 21, 28, 9, 3, 2, 14, 8, 11, 14, 9, 11, 8, 19, 3, 10, 6, 12, 10, 8, 23, 15, 27, 21, 3, 4, 7],
    3: [5, 9, 0, 11, 7, 3, 0, 27, 3, 11, 17, 12, 25, 0, 6, 20, 3, 9, 2, 17, 25, 1, 15, 11, 3, 13, 7, 8, 27, 27, 7, 15, 16, 25, 24, 7, 27, 22, 16, 17, 5, 25, 17, 8, 22, 8, 4, 16, 6, 18, 26, 5, 0, 18, 6, 27, 0, 2, 9, 17, 11, 19, 26, 22, 17, 16, 28, 4, 10, 10, 27, 24, 12, 5, 21, 20, 16, 17, 6, 8, 21, 13, 10],
    5: [13, 23, 25, 13, 2, 27, 27, 27, 5, 14, 1, 12, 4, 9, 23, 3, 4, 9, 25, 6, 8, 17, 28, 7, 7, 21, 22, 6, 28, 10, 19, 1, 12, 24, 12, 12, 9, 24, 25, 8, 15, 24, 24, 9, 10, 26, 14, 17, 11, 4, 16, 0, 14, 23, 0, 22, 9, 12, 27, 24, 21, 22, 12, 11, 10, 24, 4, 28, 18, 4, 9],
    4: [3, 0, 5, 3, 12, 27, 0, 13, 6, 19, 18, 10, 13, 18, 25, 6, 19, 4, 26, 2, 23, 6, 28, 0, 14, 23, 14, 0, 9, 21, 16, 12, 23, 0, 1, 26, 3, 26, 28, 15, 20, 11, 19, 20, 20, 26, 7, 18, 22, 8, 4, 6, 19, 23, 17, 5, 28, 11, 28, 4, 4, 22, 17, 19, 11, 25, 18, 5, 2, 8, 10, 15, 25, 22, 0, 15, 18, 17, 4, 5, 17, 24, 9]
}

def load_runes(page_num):
    paths = [
        f"LiberPrimus/pages/page_{page_num:02d}/runes.txt",
        f"LiberPrimus/pages/page_{page_num:02d}/runes.txt"
    ]
    for path in paths:
        if os.path.exists(path):
            with open(path, 'r', encoding='utf-8') as f:
                return f.read()
    return ""

def apply_key(page_num):
    key = KEYS[page_num]
    runes_text = load_runes(page_num)
    
    print(f"\n{'='*40}")
    print(f"PAGE {page_num} DECRYPTION")
    print(f"{'='*40}")
    
    decrypted_chars = []
    key_idx = 0
    key_len = len(key)
    
    for char in runes_text:
        if char in RUNE_MAP:
            rune_val = RUNE_MAP[char]
            k = key[key_idx % key_len]
            plain_val = (rune_val - k) % 29
            decrypted_chars.append(TRANS_MAP[plain_val])
            key_idx += 1
        else:
            decrypted_chars.append(char)
            
    result = "".join(decrypted_chars)
    print(result)

def main():
    for page in [1, 2, 3, 4, 5]:
        apply_key(page)

if __name__ == '__main__':
    main()
